@startuml
skinparam componentStyle rectangle
skinparam defaultFontName Monospace

title OmniOpt Architecture

package "OmniOpt Workflow" {

  node "User" {
    component "Web GUI\n(optional)" as GUI
    component "CLI Command\nomniopt ..." as CLI
    GUI --> CLI : Generate command
  }

  database "Local 'runs/' directory" as RunsFolder

  package "Execution Modes" {

    folder "Local Mode" {
      component "OmniOpt Core\n(main script)" as LocalCore
      component "Evaluation Jobs\n(sequential)" as LocalJobs

      CLI --> LocalCore : Run
      LocalCore --> LocalJobs : evaluate()
      LocalJobs --> RunsFolder : write results
    }

    folder "HPC Mode (via Submitit)" {
      node "Head Node\n(SBATCH job)" {
        component "OmniOpt Core\n(main script)" as HPCMaster
      }

      cloud "Compute Nodes\n(parallel jobs)" {
        node "Node 1" {
          component "Job 1"
        }
        node "Node 2" {
          component "Job 2"
        }
        node "Node 3" {
          component "Job 3"
        }
      }

      CLI --> HPCMaster : Run via sbatch
      HPCMaster --> Job1 : dispatch
      HPCMaster --> Job2 : dispatch
      HPCMaster --> Job3 : dispatch

      Job1 --> RunsFolder : write results
      Job2 --> RunsFolder : write results
      Job3 --> RunsFolder : write results
    }
  }

  database "OmniOpt Server\n(optional live upload)" as OmniOptServer

  LocalCore --> OmniOptServer : --live_share (optional)
  HPCMaster --> OmniOptServer : --live_share (optional)

}

@enduml
