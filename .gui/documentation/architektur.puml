@startuml
skinparam componentStyle rectangle
skinparam defaultFontName Monospace

title OmniOpt Architecture

package "OmniOpt Workflow" {

  node "User" {
    component "Web GUI\n(optional)" as GUI
    component "CLI Command\nomniopt ..." as CLI
    GUI --> CLI : Generate command
  }

  database "OmniOpt Server\n(optional live upload)" as OmniOptServer

  package "Local Mode" {
    node "Local System" {
      component "OmniOpt Core\n(main script)" as LocalCore
      component "Evaluation Jobs\n(sequential)" as LocalJobs
      database "runs/ (local)" as LocalRuns
    }

    CLI --> LocalCore : Run
    LocalCore --> LocalJobs
    LocalJobs --> LocalRuns : write results
    LocalCore --> OmniOptServer : --live_share (optional)
  }

  package "HPC Mode (via submitit/sbatch)" {

    component "OmniOpt Core\n(main script)" as HPCMaster

    CLI --> HPCMaster : Run via sbatch

    node "Head Node\n(SBATCH job)" {
      database "runs/ (on file system)" as HPCRuns
    }

    cloud "Compute Nodes\n(parallel jobs)" {
      node "Node 1" {
        component "Job 1" as Job1
      }
      node "Node 2" {
        component "Job 2" as Job2
      }
      node "Node 3" {
        component "Job 3" as Job3
      }
    }

    HPCMaster --> Job1 : submit
    HPCMaster --> Job2 : submit
    HPCMaster --> Job3 : submit

    Job1 --> HPCRuns : write results
    Job2 --> HPCRuns : write results
    Job3 --> HPCRuns : write results

    HPCMaster --> OmniOptServer : --live_share (optional)
  }
}

@enduml

