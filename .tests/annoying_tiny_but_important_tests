#!/bin/bash

# HELPPAGE: Tests that run very quickly and are annoying when the fail fast too late

tests=(
	shellcheck
	find_functions_with_missing_types
	find_wrongly_typed_cli_args
	single_quotes_in_configloader
	find_untyped_cli_args
	find_unused_params
	unit_tests
	find_unused_share_functions
	all_oo_options_are_in_gui_and_vice_versa
	lizard
	doc_has_outdated_params
	find_functions_that_are_defined_multiple_times
	php_files
	find_typos
	check_state_file_documentation
	find_missing_toc_in_md_files
	find_double_function_names
	find_double_add_arguments_help
	find_add_arguments_with_double_quotes
	flake8
	deadcode
	bandit
	find_missing_env_vars_documentation
	state_files
	folder_structure
	find_double_function_thats_already_in_helper
	find_unused_functions_in_omniopt
	php_search
	missing_plot_metadata
	share_tests
	js_syntax
	pyright
)

code=1
total_start=$(date +%s)

for t in "${tests[@]}"; do
    start=$(date +%s)
    printf "Running %-20s ... \n" "$t"

    if .tests/"$t"; then
        end=$(date +%s)
        runtime=$((end - start))
    else
        end=$(date +%s)
        runtime=$((end - start))
        printf "\033[31mFAIL\033[0m (%ds)\n" "$runtime"
        exit $code
    fi

    code=$((code+1))
done

total_end=$(date +%s)
total_runtime=$((total_end - total_start))

echo "Annoying tiny but important tests all OK in $total_runtime seconds"

exit 0
