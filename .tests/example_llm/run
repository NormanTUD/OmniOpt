#!/bin/bash -l

set -e

VENV_DIR="./.venv"

if [ ! -d "$VENV_DIR" ]; then
	echo "Creating virtual environment..."
	python3 -m venv "$VENV_DIR"

	source "$VENV_DIR/bin/activate"
	echo "Installing dependencies..."
	pip install --upgrade pip

	if command -v ml &> /dev/null; then
		ml release/23.04 GCC/11.3.0 OpenMPI/4.1.4 PyTorch/1.12.1-CUDA-11.7.0
	else
		echo "ml is not installed. Will install torch via pip"
	fi

	pip install torch torchvision transformers datasets tqdm colorama
fi

source "$VENV_DIR/bin/activate"

python3 train.py "$@"
