<!DOCTYPE html>
<html>
<head>
    <title>Prepare your program for OmniOpt</title>
    <link href="jquery-ui.css" rel="stylesheet">
    <style>
        body {
            font-family: Verdana, sans-serif;
        }
        .toc {
            margin-bottom: 20px;
        }
        .toc ul {
            list-style-type: none;
            padding: 0;
        }
        .toc li {
            margin-bottom: 5px;
        }
        .toc a {
            text-decoration: none;
            color: #007bff;
        }
        .toc a:hover {
            text-decoration: underline;
        }
    </style>
    <link href="prism.css" rel="stylesheet" />
</head>
<body>
    <h1>Run Script for OmniOpt on HPC Systems</h1>
    
    <div class="toc">
        <h2>Table of Contents</h2>
        <ul>
            <li><a href="#script-example">Script Example</a></li>
            <li><a href="#argument-parsing">Parse Arguments from the Command Line</a>
                <ul>
                    <li><a href="#sys-argv">Using sys.argv</a></li>
                    <li><a href="#argparse">Using argparse</a></li>
                </ul>
            </li>
        </ul>
    </div>

    <h2 id="script-example">Script Example</h2>
    <p>To make your script robust enough for the environment of OmniOpt on HPC-Systems,
    it is recommended that you do not run your script directly in the objective program
    string. Rather, it is recommended that you create a <tt>run.sh</tt>-file from which
    your program gets run.</p>

    <p>It may look like this:</p>

    <pre><code class="language-bash">#!/bin/bash -l
# ^ Shebang-Line, so that it is known that this is a bash file
# -l means 'load this as login shell', so that /etc/profile gets loaded and you can use 'module load' or 'ml' as usual

# If you use this script not via `./run.sh' or just `srun run.sh', but like `srun bash run.sh', please add the '-l' there too.
# Like this:
# srun bash -l run.sh

# Load modules your program needs, always specify versions!
ml TensorFlow/2.3.1-fosscuda-2019b-Python-3.7.4 # Or whatever modules you need

# Load specific virtual environment (if applicable)
source /path/to/environment/bin/activate

# Load your script. $@ is all the parameters that are given to this run.sh file.
python3 /absolute/path/to_script.py $@
</code></pre>

    <p>Even though <tt>sbatch</tt> may inherit shell variables like loaded modules, 
    it is not recommended to rely on that heavily, because, especially when
    copying the <tt>curl</tt>-command from this website, you may forget loading
    the correct modules. This makes your script much more robust to changes.</p>

    <p>Also, always load specific module-versions and never let <tt>lmod</tt> guess
    the versions you want. Once these change, you'll almost certainly have problems
    otherwise.</p>

    <h2 id="argument-parsing">Parse Arguments from the Command Line</h2>

    <h3 id="sys-argv">Using sys.argv</h3>
    <p>The following Python program demonstrates how to parse command line arguments using <tt>sys.argv</tt>:</p>

    <pre><code class="language-python">import sys

try:
	epochs = int(sys.argv[1])
	learning_rate = float(sys.argv[2])
	model_name = sys.argv[3]

	if epochs <= 0:
	    print("Error: Number of epochs must be positive")
	    return
	if not 0 < learning_rate < 1:
	    print("Error: Learning rate must be between 0 and 1")
	    return

	print(f"Running with epochs={epochs}, learning_rate={learning_rate}, model_name={model_name}")

	# Your code here

	# loss = model.fit(...)

	print(f"RESULT: {loss}")
except IndexError:
	print("Error: Not enough arguments provided.")
	print("Usage: python3 script.py <epochs> <learning_rate> <model_name>")
except ValueError:
	print("Error: Invalid type for arguments.")
	print("Usage: python3 script.py <epochs> <learning_rate> <model_name>")
</code></pre>

    <p>Example call:</p>
    <pre><code class="language-bash">python3 script.py 10 0.01 MyModel</code></pre>
    <p>Example OmniOpt-call:</p>
    <pre><code class="language-bash">python3 script.py %(epochs) %(learning_rate) %(model_name)</code></pre>

    <h3 id="argparse">Using argparse</h3>
    <p>The following Python program demonstrates how to parse command line arguments using <tt>argparse</tt>:</p>

    <pre><code class="language-python">import argparse
import sys

parser = argparse.ArgumentParser(description="Run a training script with specified parameters.")
parser.add_argument("epochs", type=int, help="Number of epochs")
parser.add_argument("learning_rate", type=float, help="Learning rate")
parser.add_argument("model_name", type=str, help="Name of the model")

args = parser.parse_args()

if args.epochs <= 0:
	print("Error: Number of epochs must be positive")
	sys.exit(1)
if not 0 < args.learning_rate < 1:
	print("Error: Learning rate must be between 0 and 1")
	sys.exit(2)

print(f"Running with epochs={args.epochs}, learning_rate={args.learning_rate}, model_name={args.model_name}")

# Your code here

# loss = model.fit(...)

print(f"RESULT: {loss}")
</code></pre>

    <p>Example call:</p>
    <pre><code class="language-bash">python3 script.py --epochs 10 --learning_rate 0.01 --model MyModel</code></pre>
    <p>Example OmniOpt-call:</p>
    <pre><code class="language-bash">python3 script.py --epochs %(epochs) --learning_rate %(learning_rate) --model %(model_name)</code></pre>

    <p><strong>Advantages of using <tt>argparse</tt>:</strong></p>
    <ul>
        <li>Order of arguments does not matter; they are matched by name.</li>
        <li>Type checking is automatically handled based on the type specified in <tt>add_argument</tt>.</li>
        <li>Generates helpful usage messages if the arguments are incorrect or missing.</li>
        <li>Supports optional arguments and more complex argument parsing needs.</li>
    </ul>

    <script src="prism.js"></script>
    <script>
        Prism.highlightAll();
    </script>
</body>
</html>

