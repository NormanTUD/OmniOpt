<!DOCTYPE html>
<html>
<head>
    <title>OmniOpt2 GUI</title>
    <style>
        .color_red {
            color: red;
        }

        .color_orange {
            color: orange;
        }

        #config_table > tbody > tr:nth-child(odd) {
            background-color: #ffffff;
        }

        #config_table > tbody > tr:nth-child(even) {
            background-color: #cfcfcf;
        }
    </style>
    <script src="https://code.jquery.com/jquery-3.7.1.js" crossorigin="anonymous"></script>
    <script>
        // Daten für die Tabellenoptionen und -werte
;var tableData = [
    { label: "Experiment name", id: "experiment_name", type: "text", value: "", placeholder: "Name of your experiment (only letters)" },
    { label: "Memory (in GB)", id: "mem_gb", type: "number", value: 1, placeholder: "Memory in GB per worker" },
    { label: "Timeout for the main program", id: "time", type: "number", value: 60, placeholder: "Timeout for the whole program (minutes)" },
    { label: "Timeout for a single worker", id: "worker_timeout", type: "number", value: 60, placeholder: "Timeout for a single worker (minutes)" },
    { label: "Maximal number of evaluations", id: "max_eval", type: "number", value: 500, placeholder: "Maximum number of evaluations" },
    { label: "Number of maximum parallel evaluations", id: "num_parallel_jobs", type: "number", value: 500, placeholder: "Maximum number of parallel evaluations" },
    { label: "GPUs", id: "gpus", type: "number", value: 0, placeholder: "Number of GPUs" },
    { label: "Follow", id: "follow", type: "checkbox", value: 1 },
    { label: "Verbose", id: "verbose", type: "checkbox", value: 0 },
    { label: "Debug", id: "debug", type: "checkbox", value: 0 },
    { label: "Maximize?", id: "maximize", type: "checkbox", value: 0 },
    { label: "Run program", id: "run_program", type: "text", value: "", placeholder: "Your program with parameters" }
];


	function update_command() {
		var errors = [];
		var warnings = [];
		var command = "./main";

		tableData.forEach(function(item) {
			var value = $("#" + item.id).val();
			if (item.type === "checkbox") {
				value = $("#" + item.id).is(":checked") ? "1" : "0";
			}

			if (item.type === "text" && value === "") {
				errors.push("Field '" + item.label + "' is required.");
			} else if (item.type === "number" && isNaN(value)) {
				errors.push("Invalid value for '" + item.label + "'. Must be a number.");
			} else {
				command += " --" + item.id + "='" + value + "'";
			}
		});

		if (errors.length) {
			$("#command").html("<span class='color_red'>" + errors.join("<br>") + "</span>");
		} else {
			$("#command").text(command);
		}

		if (warnings.length) {
			$("#warnings").html("<span class='color_orange'>" + warnings.join("<br>") + "</span>").show();
		} else {
			$("#warnings").html("").hide();
		}
	}
	
			function updateOptions(select) {
				var selectedOption = select.value;
				var valueCell = select.parentNode.nextSibling;
				if (selectedOption === 'range') {
					valueCell.innerHTML = `<table>
					<tr>
					    <td>
						Name:
					    </td>
					    <td>
						<input onchange="update_command()" onkeyup="update_command()" onclick="update_command()"  type='text' class='parameterName'>
					    </td>
					</tr>
					<tr>
					    <td>
						Min:
					    </td>
					    <td>
						<input onchange="update_command()" onkeyup="update_command()" onclick="update_command()"  type='number' class='minValue'>
					    </td>
					</tr>
					<tr>
					    <td>
						Max:
					    </td>
					    <td>
						<input onchange="update_command()" onkeyup="update_command()" onclick="update_command()"  type='number' class='maxValue'>
					    </td>
					</tr>
					<tr>
					    <td>
						Type:
					    </td>
					    <td>
						<select  onchange="update_command()" onkeyup="update_command()" onclick="update_command()" id="numberTypeSelect">
							<option value="float">Float</option>
							<option value="int">Integer</option>
						</select>
					    </td>
					</tr>
				    </table>`;
				} else if (selectedOption === 'choice') {
					valueCell.innerHTML = `<table>
						<tr>
						    <td>
							Name:
						    </td>
						    <td>
							<input  onchange="update_command()" onkeyup="update_command()" onclick="update_command()" type='text' class='parameterName'>
						    </td>
						</tr>
						<tr>
							<td>Values (comma separated):</td>
							<td><input onchange="update_command()" onkeyup="update_command()" onclick="update_command()"  type='text' class='choiceValues'></td>
						</tr>
					</table>`;
				} else if (selectedOption === 'fixed') {
					valueCell.innerHTML = `<table>
						<tr>
						    <td>
							Name:
						    </td>
						    <td>
							<input onchange="update_command()" onkeyup="update_command()" onclick="update_command()"  type='text' class='parameterName'>
						    </td>
						</tr>
						<tr>
							<td>Value:</td>
							<td><input onchange="update_command()" onkeyup="update_command()" onclick="update_command()"  type='text' class='fixedValue'></td>
						</tr>
					</table>`;
				}
			}

			function addRow(button) {
				// Funktion zum Hinzufügen einer neuen Zeile
				var table = document.getElementById("config_table");
				var rowIndex = button.parentNode.parentNode.rowIndex; // Index der aktuellen Zeile
				var newRow = table.insertRow(rowIndex + 1); // Neue Zeile nach der aktuellen einfügen

				// Neue Zellen für die Zeile erstellen
				var optionCell = newRow.insertCell(0);
				var valueCell = newRow.insertCell(1);
				var buttonCell = newRow.insertCell(2);

				// Inhalt der Zellen setzen
				optionCell.innerHTML = "<select onchange='updateOptions(this)' class='optionSelect'><option value='range'>Range</option><option value='choice'>Choice</option><option value='fixed'>Fixed</option></select>";
				valueCell.innerHTML = ""; // Leerer Platz für die Optionen

				buttonCell.innerHTML = "<button onclick='removeRow(this)'>-</button>"; // Minus-Button für die neue Zeile
				button.parentNode.innerHTML = "<button onclick='addRow(this)'>+</button>"; // Plus-Button in der aktuellen Zeile entfernen

				updateOptions(optionCell.firstChild); // Direkt die Optionen aktualisieren

				// Klassen hinzufügen
				newRow.classList.add('configRow');
				optionCell.firstChild.classList.add('optionSelect');
				valueCell.firstChild.classList.add('valueInput');

				update_command(); // Befehl aktualisieren
			}

			function removeRow(button) {
				// Funktion zum Entfernen der aktuellen Zeile
				var table = document.getElementById("config_table");
				var rowIndex = button.parentNode.parentNode.rowIndex; // Index der aktuellen Zeile
				var rowCount = table.rows.length;
				if (rowCount > 2) { // Stellen Sie sicher, dass mindestens eine Zeile unentfernbar ist
					table.deleteRow(rowIndex); // Aktuelle Zeile entfernen
					updateButtons(); // Plus- und Minus-Buttons aktualisieren
					update_command(); // Befehl aktualisieren
				}
			}

			function updateButtons() {
				// Funktion zum Aktualisieren der Plus- und Minus-Buttons in jeder Zeile
				var table = document.getElementById("config_table");
				var rows = table.rows;
				for (var i = 1; i < rows.length - 1; i++) {
					if (rows[i].cells.length >= 3) { // Überprüfen, ob die Zeile mindestens drei Zellen hat
						rows[i].cells[2].innerHTML = "<button onclick='removeRow(this)'>-</button>"; // Minus-Button
					}
				}
				rows[rows.length - 1].cells[2].innerHTML = "<button onclick='addRow(this)'>+</button>"; // Plus-Button
			}

        // Funktion zum Erstellen der Tabelle basierend auf den Daten
function createTable() {
    var table = $("#config_table");
    var tbody = table.find("tbody");

    tableData.forEach(function(item) {
        var row = $("<tr>");
        var labelCell = $("<td>").text(item.label);
        var valueCell = $("<td>").attr("colspan", "2");

        var input = $("<input>").attr({ id: item.id, type: item.type, value: item.value, placeholder: item.placeholder });

        if (item.type === "checkbox") {
            input.prop("checked", item.value);
        }

        input.on({
            change: update_command,
            keyup: update_command,
            click: update_command
        });

        valueCell.append(input);
        row.append(labelCell, valueCell);
        tbody.append(row);
    });

    // Plus-Button hinzufügen
    tbody.append("<tr><td colspan='3'><button onclick='addRow(this)' id='add_row_button'>+</button></td></tr>");
}

        // Funktion zum Aktualisieren des Befehls

        $(document).ready(function() {
            createTable();
            $("#add_row_button").click();
            update_command();
        });
    </script>
</head>
<body>
<table>
    <tr>
        <td>
            <table id="config_table" border="1">
                <thead>
                <tr>
                    <th>Option</th>
                    <th colspan="2">Value</th>
                </tr>
                </thead>
                <tbody></tbody>
            </table>
        </td>
        <td>
            <code id="command"></code>
            <div id="warnings" style="display: none"></div>
        </td>
    </tr>
</table>
</body>
</html>

