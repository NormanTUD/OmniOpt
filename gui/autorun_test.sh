#!/bin/bash

RANDOMFOLDER=${RANDOM}_${RANDOM}

WS_PATH=$(ws_allocate -F scratch $RANDOMFOLDER | grep scratch 2>/dev/null)
cd $WS_PATH
curl https://imageseg.scads.ai/omnioptgui/omniopt_script.sh 2>/dev/null | bash -s -- --projectname=test_project --config_file=W0RBVEFdCm51bWJlcl9vZl93b3JrZXJzID0gNQpudW1fZ3B1c19wZXJfd29ya2VyID0gMQpwcmVjaXNpb24gPSA4CnBhcnRpdGlvbiA9IGhhc3dlbGw2NApwcm9qZWN0bmFtZSA9IHRlc3RfcHJvamVjdAplbmFibGVfZ3B1cyA9IDAKbWVtX3Blcl9jcHUgPSAyMDAwCmNvbXB1dGluZ190aW1lID0gMQptYXhfZXZhbHMgPSAxMDAKYWxnb19uYW1lID0gdHBlLnN1Z2dlc3QKcmFuZ2VfZ2VuZXJhdG9yX25hbWUgPSBocC5yYW5kaW50Cm9iamVjdGl2ZV9wcm9ncmFtID0gcGVybCAtZSAndXNlIGJpZ2ludDsgcHJpbnQgcXEjUkVTVUxUOiAjLihvcmQoIigkeF8wKSIpICsgKCR4XzEpKS5xcSNcbiMnCgpbRElNRU5TSU9OU10KZGltZW5zaW9ucyA9IDIKCmRpbV8wX25hbWUgPSBhc2RmCnJhbmdlX2dlbmVyYXRvcl8wID0gaHAucGNob2ljZQpvcHRpb25zXzAgPSBhPTIwLGI9NzAsYz0xMAoKZGltXzFfbmFtZSA9IGEKcmFuZ2VfZ2VuZXJhdG9yXzEgPSBocC5jaG9pY2UKb3B0aW9uc18xID0gMSwyLDMsNCw1LDYsNyw4LDksMTAsMTEKCltERUJVR10KZGVidWdfeHRyZW1lID0gMApkZWJ1ZyA9IDAKaW5mbyA9IDAKd2FybmluZyA9IDAKc3VjY2VzcyA9IDAKc3RhY2sgPSAwCnNob3dfbGl2ZV9vdXRwdXQgPSAwCgpbTU9OR09EQl0Kd29ya2VyX2xhc3Rfam9iX3RpbWVvdXQgPSA1MDAKcG9sbF9pbnRlcnZhbCA9IDEwCmtpbGxfYWZ0ZXJfbl9ub19yZXN1bHRzID0gMTAwMDAwCg== --sbatch_command=c2JhdGNoIC1KIHRlc3RfcHJvamVjdCAgIC0tbnRhc2tzPTUgICAtLXRpbWU9MTowMDowMCAgIC0tbWVtLXBlci1jcHU9MjAwMCAgIC0tcGFydGl0aW9uPWhhc3dlbGw2NCAgIHNiYXRjaC5wbCAtLXByb2plY3Q9dGVzdF9wcm9qZWN0ICAgLS1wYXJ0aXRpb249aGFzd2VsbDY0ICAtLW51bV9ncHVzX3Blcl93b3JrZXI9MCA= --no_taurus_check --no_warning_home --dont_add_to_shell_history --no_install_zsh_autocomp --auto_accept_projectname --auto_continue_job --dont_start_job --no_error_analyze
cd omniopt
perl sbatch.pl --run_full_tests --no_color
ws_release $RANDOMFOLDER
